---
title: "Análise Descritiva"
subtitle: "Uma Introdução à Estatística"
author:
- Alexandre Nicolella e Felipe Bauer
date: "2024"
format: html
---

## Porque Estudar Estatística?

Podemos dizer que a existência da estatística e de outras ciências está conectada a existência de problemas. Não somente a ciência mas o nosso trabalho está conectado a superação de problemas cotidianos. Tomar decisão é o dia a dia do gestor.

Segundo Popper "we study not disciplines, but problems. Often, problems transcend the boundaries of a particular discipline"

A questão central é: Como solucionamos os problemas? Utilizamos a melhor estratégia? A solução foi boa?

```{mermaid}
flowchart LR
  A[PROBLEMA] --> B[Estratégia de Decisão]
  B --> C{Solução é BOA?}
```

### Os dois sistemas cognitivos

Os livros abaixo são boas referências sobre a tomada de decisão.

::: {layout="[30,-40,30]"}
![Rápido e Devagar: Duas Formas de Pensar](figuras\kahneman.jpg){width="10%"}

![Processo Decisório](figuras\bazerman.jpg){width="10%"}
:::

Existem dois sistemas que utilizamos para tomar decisão. O chamado **Sistema 1** e o chamado **Sistema 2**. Segue uma breve descrição de cada um:

**Sistema 1**:

-   Intuitivo, rápido, automático, sem esforço, implícito e emocional
    -   Pressa,
    -   Falta de tempo,
    -   Problemas menos importante
    -   Mais Falhas/Erros

**Sistema 2**

-   Raciocíonio lento, consciente, esforçado, explícito, lógico
    -   Requer tempo,
    -   Mais recursos
    -   Problemas mais importante
    -   Menos Falhas

Para o Sistema 1 usamos a nossa intuição que chamamos de Heurística. Vejamos um pouco mais sobre esse sistema.

**HEURÍSTICA**

São rotinas inconscientes ou atalhos que o nosso cérebro utiliza para lidar com a complexidade.

-   Modelo/Regras Intuitivas.
-   Próprio do Sistema 1.
-   Apesar de processo sofisticado, são passíveis de falhas. Intuição falha

[**Um Exemplo**]{.underline}

Veja a figura abaixo retirada do livro do Bazerman.Responda rápido.

**Qual delas tem o tampo mais quadrado?**

![Bazerman: Exemplo das mesas](figuras\mesa.jpg){width="80%"}

Se você achou que é a segunda mesa, você está alinhado com a grande maioria. Nesse caso você usou o seu sistema 1

Vamos repitir a pergunta:

**Qual delas tem o tampo mais quadrado?**

Agora use uma régua para medir as mesas. Usamos aqui o sistema 2. Mais tempo e recursos são utlizados. Qual mesa agora você considera mais quadrada? Mudou sua opinião?

Com a régua vemos que as mesas são iguais. Isso mostra que a nossa intuição **FALHA**.

**Tipos de Heurísticas**

-   **Heurística da disponibilidade**: Usamos o que está mais próximo na memória para calcular a probabilidade.

-   **Heurística da representatividade**: Buscamos aquilo que reforça o padrão.

-   **Heurística da hipótese positiva**: Assumimos que uma determinada hipótese é verdadeira e não olhamos o contrafactual.

-   **Heurística do afeto**: Decisão considera o emocional. Seu humor afetam as decisões.

Para contornar os problemas da intuição e seus viéses na tomada de decisão o primeiro passo é compreender que eles existem e estarmos alerta. E para problemas maiores o uso do sistema 2 torna-se relevante.

Uma das principais ferramentas do sistema 2 é a Estatística. Com os avanços computacionais essa ciência tem se destacado como um dos elementos centrais do *data science*. Abaixo a figura resume as diversas áreas de desenvolvimento da análise de dados, obviamente não exaustiva:

![Bazerman: mesas](figuras\analisedados.jpg){width="80%"}

Nosso objetivo é explorar nessa seção a análise descritiva. Chamado hoje no *Business Intelligence*, que e uma das áreas do *Data Science*.

## Conceitos Básicos de Estatística

Novamente começamos com um problema e esse definirá a nossa análise. Vejamos alguns problemas que poderiam nos interessar...

::: callout-note
## Problema 1

O prefeito de Ribeirão Preto vai lançar uma política que fornece vouchers de alimentação para mulheres que estão em situação de pobreza.

**Problema**: [Qual o valor que devo reservar ao programa? Quantas mulheres serão atendidas?]{.underline}
:::

::: callout-note
## Problema 2

O TJSP vai lançar um programa para reduzir o tempo médio em processos de feminicídio.

**Problema**: [Qual o tempo médio de um processo de feminicídio?]{.underline}
:::

::: callout-note
## Problema 3

O O governo federal vai lançar um programa para capacitar mulheres que estão fora do mercado de trabalho.

**Problema**: [Quantas mulheres serão alvos dessa política?]{.underline}
:::

### A Variável Aleatória

O problema nos define a população que estou interessado. Vamos seguir, a princípio, com o nosso probelma 1 para definirmos alguns conceitos importantes.

**No problema 1**: me interessa compreender a renda das mulheres que moram em Ribeirão Preto em dado ano. Para ficar simples vamos abreviar o que nos interessa

$$X=\text{Renda das mulheres que moram em Ribeirão Preto em determinado ano}$$ Agora posso utilizar o X no lugar do nome. Olhando para a população e pensando que cada nível de renda pode ser representada por uma cor, teremos a seguinte imagem pouco de como a renda se distribui nessa população:

![Renda pc das mulheres de Ribeirão Preto.](figuras\lego.jpg){width="50%"}

A questão é: quais cores existem e quantas peças de cada cor temos? Para isso usamos um experimento

**EXPERIMENTO ALEATÓRIO**

O experimento em ciências sociais aplicadas em geral está associada a observação sistemática de pessoas, cidades, empresas ou processos. A ideia é:

-   Sortear pessoas e observar a sua caracteristica de forma indefinida e sempre na mesma condição.\
-   Não consigo dizer o que vai sair no próximo sorteio, apenas consigo descrever os resultados possíveis
-   Se repetir o experimento um número grande de vezes uma regularidade aparece.

Se eu conseguir sortear de forma indefinida e na mesma condição as mulheres que moram em Ribeirão Preto e perguntar sobre a sua renda. Eu consigo reorganizar a figura acima da seguinte forma:

![Renda pc das mulheres de Ribeirão Preto.](figuras\lego_org.jpg){width="50%"}

**ESPAÇO AMOSTRAL**

Agora conseguimos organizar os nossos resultados em um lugar chamado espaço amostral. Nele teremos todas as cores (azul, branca, amarela...) que podem acontecer e o número de peças de cada cor (a chance). Em outras palavras teremos todos os possíveis valores de $X$ e suas probabilidades.

**VARIÁVEL ALEATÓRIA**

Quanto representamos esse espaço amostral em formato de números é o que chamamos de Variável Aleatória (V.A.). A V.A. é a combinação de tudo que pode acontecer, ou seja, todas as rendas que existem associadas a probabilidade de cada uma das rendas acontecerem.

Existem dois tipos principais de variáveis aleatórias: discretas e contínuas.

**VARIÁVEIS ALEATÓRIAS DISCRETAS**

É um tipo de variável que conseguimos colocar em lista, seja finita ou infinita $x_1; x_2;...; x_n;...$ e associa-se a cada um dessses valores uma probabilidade $p(x_1); p(x_2);...; p(x_n);...$

Podemos pensar aqui se a pessoa é casada, solteira, divorciada, viúva ou outra condição. Se no processo classificamos como homicídio ou feminicídio, se mora na área urbana ou rural...

Na figura abaixo iremos coletar de 20 processos de homicídio e gostariamos de saber quando é classificado como feminicídio e quanto é classificado como homicídio (p=0,3).

```{r echo = TRUE, fig.cap= "Distribuição Normal",fig.height = 3.5, fig.width = 5}
feminicidio <- 0:20

plot(feminicidio,dbinom(feminicidio,size=20,prob=.3),
     type='h',
     main='Distribuição Binomial (n=20, p=0.3)',
     ylab='Probabilidade',
     xlab ='Feminicídio',
     lwd=3)
```

**VARIÁVEIS ALEATÓRIAS CONTÍNUAS**

Por outro lado, uma variável aleatória contínua pode assumir infinito valores dentro de um intervalo específico. Agora temos infinitas possibilidades de resultados para $X$ e agora associamos uma função $f(x)$ que irá descrever o comportamento da probabilidade.

Por exemplo, a altura de uma pessoa, a sua renda, a sua idade, o tempo que demora um processo.

Abaixo temos uma representação de uma distriuição continua da renda das mulheres em Ribeirão Preto, chamada distribuição normal:

```{r echo = TRUE, fig.cap= "Distribuição Normal",fig.height = 3.5, fig.width = 5}
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
x<-seq(700,1300,1)
fdnorm<-dnorm(x = x, mean = 1000, sd=100)  
fdanorm<-pnorm(q = x, mean = 1000, sd=100)
curve(dnorm(x,1000,100),xlim=c(700,1300),main='',xaxt="n",xlab="Renda pc Mulheres", ylab="f(x)",col="darkblue",cex.axis=0.65, cex.lab=0.8) 
axis(1,at=c(900, 1000, 1100),labels =
       c("-DP(X)","E(x)","DP(x)"),cex.axis=0.65, cex.lab=0.8) 
lines(x=c(1000,1000),y=c(0,fdnorm[x==1000]),lty=2, col="black") 
lines(x=c(1100,1100),y=c(0,fdnorm[x==1100]),lty=2, col="black")
lines(x=c(900,900),y=c(0,fdnorm[x==900]),lty=2, col="black")

```

#### Esperança e Variância

O fomato das distribuições vistas dependem principalmente de dois parâmetros: A esperança que é uma medida de centralidade e a variância que é uma medida de dispersão.

**ESPERANÇA** - $E(X)$

É uma medida de centralidade da variável aleatória. É definida como a média ponderada de todos os possíveis resultados de $X$, onde os pesos são dados pelas probabilidades desses resultados ocorrerem. A esperança de $X$, $E(X)$, é calculada como:

$$E(X) = \sum_{x} x \cdot P(X = x)$$

para variáveis discretas.

$$E(X) = \int_{-\infty}^{\infty} x \cdot f(x)$$,

para variáveis contínuas

**VARIÂNCIA POPULACIONAL** - $Var(X)$

A variância é uma medida que captura como os dados populacionais se dispersão em relação a sua média (ou esperança).

$$Var(X) =\frac{1}{N} \sum_{1}^{N} (X_i-E(X))^2$$ Ou podemos assim representar: $$\text{Var}(X) = E(X^2) - [E(X)]^2$$.

**DESVIO PADRÃO POPULACIONAL** - $DP(X)$

A variãncia é uma medida ao quadrado. Se estamos falando da renda seria uma medida da dispersão ao quadrado, ou seja, em $R\$^{2}$. Para retornar a unidade original usamos o desvio padrão que é:

$$DP(X)=\sqrt{Var(X)}$$

Vejamos o que acontece quando mudamos a esperança e o desvio padrão. No gráfico em azul temos a esperança igual a 10 e devio padrão de 2,5. No gráfico em vermelho temos esperança de 20 e desvio padrão de 10. E no grafico em verde temos esperança de 10 e desvio padrão de 1. Nota-se que quanto menor o desvio padrão mais concentrados são os valores que podem acontecer.

```{r echo = TRUE, fig.cap= "Médias e desvios distintos entre distribuições",fig.height = 3.5, fig.width = 6}
curve(dnorm(x,mean=10,sd=sqrt(2.5)),xlim=c(0,30),ylim=c(0.0,0.4),xaxs="i",yaxs="i",ylab="", col="darkblue") 
par(new=T)
curve(dnorm(x,mean=20,sd=sqrt(10)),xlim=c(0,30),ylim=c(0.0,0.4),xaxs="i",yaxs="i",ylab="", col="darkred") 
par(new=T)
curve(dnorm(x,mean=20,sd=sqrt(1)),xlim=c(0,30),ylim=c(0.0,0.4),xaxs="i",yaxs="i",ylab="", col="darkgreen") 

```

### Variáveis Aleatórias Bidimensionais

Muito provavelmente nos interessa observar mais de uma característica de um experimento. Por exemplo, não somente a renda das mulheres em Ribeirão Preto nos interessa, mas o seu consumo alimentar também julgamos importante para o projeto.

Portanto, queremos observar duas características de forma simultânea das mulheres: sua renda e seu consumo alimentar. Ou seja, duas características simultaneamente do mesmo experimento $\epsilon$ que foi observar as mulheres no município.

Apesar de termos coletados duas informações, temos na realidade três informações. A informação da renda, a informação do consumo alimentar e a informação de como renda e consumo alimentar interagem.

**VISUALIZAÇÃO GRÁFICA**

Vejamos agora um exemplo de variável aleaória bidimensional:

**Normal Bivariada**:

Abaixo tem-se uma variável aleatória $(X,Y)$ com distribuição normal bivariada com a esperança de $X$ igual a 1, de $Y$ igual a 0, o desvio-padrões iguais a 3 e 2 respectivamente. Aqui consideremaos a correlação de 1 (veremos mais a frente esse conceito)

```{r echo = TRUE, fig.cap= "Normal Bivariada"}
library(mnormt)

#Para tornar reproduzível
set.seed(0)

#cCriando a normal bivariada
x     <- seq(-3, 3, 0.1) 
y     <- seq(-3, 3, 0.1)
mu    <- c(1, 0)
sigma <- matrix(c(3, 1, 1, 2), nrow=2)
f     <- function(x, y) dmnorm(cbind(x, y), mu, sigma)
z     <- outer(x, y, f)

#Criando um gráfico de superfície
persp(x, y, z, theta=-30, phi=25, expand=0.6, ticktype='detailed')
```

Surge aqui um conceito importante que tenta medir como as características da população se relacionam - uma medida do relacionamento. Assim:

[O que acontece com o consumo de alimentos quando a renda das mulheres sobem?]{.underline}

#### Covariância e Correlação

Duas medidas que tentam mensurar o "grau de associação" linear entre X e Y são:

**COVARIÂNCIA**

$$Cov(X,Y)=E[(X-E(X))(Y-E(Y))]$$

Ela mede a variabilidade conjunta de uma variável aleátoria multidimensional. Como no caso da variância, ela sofre do efeito das escalas de medidas. Para corrigir dividimos pelos desvios padrões. Surge dessa maneira a medida de correlação.

**CORRELAÇÃO**

$$\rho_{X,Y}=\frac{E[(X-E(X))(Y-E(Y))]}{\sqrt{Var(X)Var(Y)}}$$

::: callout-warning
## Correlação

A correlação mede o **GRAU DE ASSOCIAÇÃO LINEAR**. Associações não lineares não são capturadas pela correlação.
:::

::: callout-note
## Lendo a Correlação

A correlação $\rho_{X,Y}$ varia de -1 até 1. Sendo que:

$\rho$ próximo a 1 e -1 indicam alto grau de linearidade e $\rho$ próximo a 0 indica ausência de relação linear - mas não diz nada sobre relações não-lineares.
:::

**VISUALIZAÇÃO GRÁFICA**

Veja no gráfico abaixo que a variável 4 e 5 possuem correlação perfeita, igual a -1. E as variáveis 3 e 1 não possuem grau de associação linear, correlação próxima a 0.

```{r echo = FALSE, fig.cap= "Gráfico de correlação para variáveis simuladas v1 a v5",fig.height = 6, fig.width = 6, fig.align = "center"}
library(psych)
data <- data.frame( var1 = 1:100 + rnorm(100,sd=20), v2 = 1:100 + rnorm(100,sd=27), v3 = rep(1, 100) + rnorm(100, sd = 1)) 
data$v4 = data$var1 ** 2 
data$v5 = -(data$var1 ** 2) 
pairs.panels(data)
```

## Conceitos Básicos Inferência Estatística

Dado a nossa pergunta ou problema, gostariamos de saber as carcateística de uma população.

Entretantom um processo de levantamento de informações é em geral caro e em muitas situações é destrutivo. Em ciências sociais estamos interessados em características de pessoas, empresas, municípios, estados, países etc. Não é destrutivo mas é uma coleta cara. Por exemplo, o Censo demográfico de 2010 custou R\$ 1,3 bilhões, ou aproximadamente R\$ 2,2 bi em reais de 2020. O valor é de aproximadamente R\$ 35,00 por domicílio.

Dessa forma nosso objetivo aqui é:

::: callout-note
## Objetivo

A partir de uma amostra da população realizar inferência sobre toda a população
:::

### Exemplos do príncipio no dia a dia

Pense nessas situações:

-   Para medir a glicose muitos pacientes usam uma gota de sangue e um pequeno aparelho. A partir dele sabem quanto tem no corpo todo, basta uma gota para termos boa certeza de quanto é taxa de glicose!
-   Para saber se a quantidade de sal está adequada em uma grande panela de arroz, basta uma pequena colher de chá para termos uma boa certeza!
-   Abacaxis às vezes são vendidos em caminhões na rua. Quando paramos provamos e são doces. Compramos 4 por 10. Qual a certeza que esses que vc está levando estejam também doces? É diferente das situações anteriores?

Com certeza vc deve ter pensado que essas situações tem grau de certeza variáveis. A diferença está em quão homogênea é a característica na população, o sal no arroz e a glicose no sangue devem ser muito bem distribuidas, ou seja, bem homogêneas. Já a doçura no abacaxi deve ter distribuição maior e provar apenas um abacaxi não nos dá uma ideia do todo.

Esse é um erro muito comum, a partir de uma ou poucas observações dizer que o todo se comporta da mesma maneira, esse erro se agrava quando maior é a heterogeneidade!!!

### População, Amostra, Parâmetros e Estimadores

### População e amostra

```{mermaid}
flowchart LR
  A[POPULAÇÃO] --> B[Totalidade das observações sob Investigação]
  A --> C[AMOSTRA]
  C --> D[Subconjunto da População]
```

A definição da população depende da pergunta de pesquisa ou análise. Se queremos saber qual o salário médio dos empregados do setor industrial no estado de São Paulo para determinado ano, nossa população são todos os funcionários das indústrias instaladas no estado de São Paulo para esse ano. Se queremos os determinantes do desempenho escolar dos alunos do ensino fundamental no Brasil em 2019, nossa população será esse grupo de alunos nesse ano. Se quisermos avaliar o gasto municipal no ano anterior as eleições no Brasil, temos nossa população formada pelos municípios para o ano de análise.

::: callout-tip
## População

Quem define a população é o objetivo do seu trabalho!! Ou seja, seu problema de pesquisa
:::

### Amostragem Aleatória Simples

Existem várias maneiras de fazer uma análise aleatória, uma delas é a simples. Vejamos primeiro um processo de amostragem não aleatório e que possui tendenciosidade. A figura abaixo mostra esse processo\[\^7\]:

![Um processo de amostragem viesádo. Fonte:Data Basecamp](figuras\bias.jpg){width="50%"}

Observa-se que existe uma supervalorização do vermelho e uma subvalorização do azul. Chegariamos a conclusão, caso isso fosse uma pesquisa eleitoral, que o candidato vermelho, segunda amostra teria mais chance de ganhar e o azul quase nenhuma chance. O que não condiz com a população. Dizemos que temos uma amostra viesada ou tendenciosa.

Um processo de amostragem aleatório requer que as características presentes na população estejam presentes na amostras e estejam balanceadas, ou seja, que a sua leitura represente bem o todo.

## Estatística e Parâmetro

```{mermaid}
flowchart LR
  A[PARÂMETRO] --> B[Medida que descreve uma característica da população]
```

Os parâmetros definem as características de uma população. Qual a renda média da população, qual o desemprego médio da população, qual o desempenho médio educacional, qual a expectativa de vida média na população etc. São características que em geral não observamos.

Uma pergunta, qual o tempo médio que demora um processo de feminicídio? Perceba que mesmo características da população que conhecemos são de difíceis de conhecermos. Temos que nos valer de uma parte e tentar estimar o que seriam os valores dessas características.

```{mermaid}
flowchart LR
  A[ESTATÍSTICA] --> B[Medida que descreve uma característica da amostra]
```

Sejam $x_1, x_2,..., x_{n}$ os valores medidos a cada para cada medição de $X$. Podemos definir uma estatística como:

$$ t= H (x_1, x_2, ..., x_{n})$$

Alguns exemplos de T:

$$ \text{Média}: \ \overline{x}=\frac{\sum_{i=1}^{n} x_i}{n}$$

$$ \text{Variância:} \ s^{2}= \frac{1}{n-1} \sum_{i=1}^{n} (x_i - \overline{x})^{2} $$

$$ x_{(1)}: Min\{x_1, ..., x_n\}$$


Vejamos a tabela abaixo que já faz uma primeira associação entre estatística e parâmetro:

| Parâmetro      |                   | Estatística    |                    |
|----------------|-------------------|----------------|--------------------|
| Esperança      | $E(X)=\mu$        | $\bar{X}$      | Média              |
| Variância Pop. | $Var(X)=\sigma^2$ | $S^2;\sigma^2$ | Variância Amostral |
| Mediana Pop.   | Md                | md             | Mediana Amostral   |
| Proporção Pop. | p                 | $\hat{p}$      | Proporção Amostral |

[Tabela 1 - Parâmetros populacionais e as Estatísticas associadas]{caption="TRUE"}

Como regra geral, os parâmetros são representados por letras gregas e as estatística com letras do nosso alfabeto (latino) ou letra grega com com chapéu para indicar que é uma estatística.


**ESTIMADORES**
Um estimador é uma estatística calculada a partir da amostra que é usada para estimar um parâmetro desconhecido da população. Nos permitem fazer inferências sobre os parâmetros com base nos dados amostrais. Por exemplo, a média amostral é um estimador da média populacional, e a proporção amostral é um estimador da proporção populacional.


## Teste de Hipotese (Parâmetros).

### Introdução ao Teste de Hipótese de Duas Populações (de Médias)

O teste de hipótese é uma técnica estatística fundamental usada para tomar decisões baseadas em evidências amostrais. O teste de hipótese de duas populações é aplicado quando queremos comparar as médias de duas populações distintas e determinar se existe uma diferença estatisticamente significativa entre elas. Vamos explorar os principais conceitos deste teste:

**Formulação das Hipóteses**

No teste de hipótese de duas populações, formulamos duas hipóteses:

- **Hipótese Nula ($H_0$)**: Esta é a hipótese inicial que assume que não há diferença entre as médias das duas populações. Geralmente, é representada como 

$$H_0: \mu_1 = \mu_2$$, 

onde $\mu_1$ e $\mu_2$ são as médias das duas populações.

- **Hipótese Alternativa ($H_a$ ou $H_1$)**: Esta é a hipótese que queremos testar, indicando que há uma diferença significativa entre as médias das duas populações. Pode ser definida como: 
$$H_a: \mu_1 > \mu_2$$ 
ou 
$$H_a: \mu_1 < \mu_2$$ 
ou 

$$H_a: \mu_1 \neq \mu_2$$.

**Estatística do Teste**

O teste de hipótese de duas populações geralmente envolve o cálculo de uma estatística de teste específica para comparar as médias das amostras das duas populações. Uma das estatísticas comuns é o teste t de Student, especialmente quando as variâncias populacionais são desconhecidas e podem ser diferentes entre as populações.

**Decisão do Teste**

Após calcular a estatística de teste, comparamos o valor observado da estatística com um valor crítico ou calculamos um valor p associado. O valor p é a probabilidade de obter uma estatística de teste tão extrema quanto a observada, assumindo que a hipótese nula seja verdadeira. Com base no valor p (geralmente comparado com um nível de significância pré-definido, como 0,05), tomamos uma decisão de rejeitar ou não rejeitar a hipótese nula.

**Conclusão do Teste**

A conclusão do teste de hipótese de duas populações nos permite determinar se há evidências estatísticas suficientes para rejeitar a hipótese nula em favor da hipótese alternativa. Essa decisão tem implicações importantes em áreas como pesquisa científica, análise de dados e tomada de decisões em negócios e saúde.




## Estatisticas Descritivas: Medidas Numéricas a partir da amostra

Existem outros métodos númericos que se constituem como alternativas adcionais para sintetizar os dados. Podemos dividir as medidas numericas em duas, temos as medidas de posíção e as de variabilidade.

**MEDIDAS DE POSIÇÃO:**

-   Média,
-   Mediana,
-   Moda,
-   Percentis,
-   Quartis.

**MEDIDAS DE VARIABILIDADE:**

-   Amplitude,
-   Amplitude interquartil,
-   Variância,
-   Desvio Padrão e
-   Coeficiente de Variação.

**MEDIDAS DE ASSOCIAÇÃO:**

-   Covariancia e
-   Coeficiente de Correlção.

Vamos apresentar as fÓrmulas de algumas dessas principais medidas.

```{r}
final_fem_22 <- read.csv("C:/Users/Alexandre_Nicolella/Aulas/FEA-RP/Jurimetria/jurimetria/final_fem_22.csv", head=T ,sep=";")

```

### Medidas de Posição:

**MÉDIA AMOSTRAL:**

$$\bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i$$

```{r, warning=F}
mean(final_fem_22$feminic_tx)
```

```{r, warning=F}
library(kableExtra)

mean_1<- aggregate(final_fem_22[4:17], list(final_fem_22$regiao), mean,  na.rm=T)

t(mean_1) %>% 
  kbl(digits = 2) %>%
     kable_styling()
```



**MEDIANA:**

Organize os dados em ordem crescente.

a)  Para um numero impar de observações a mediana é o valor que ocupa a posição central.

b)  para um número par de observações, a mediana é a média dos dois valores centrais.


```{r, warning=F}
median(final_fem_22$feminic_tx)
```
```{r, warning=F}

fun1 <- function(x, na.rm = TRUE) c(media=mean(x, na.rm = TRUE), mediana=median(x, na.rm = TRUE))

median_1 <- (sapply(final_fem_22[4:17], fun1))

t(median_1) %>% 
  kbl(digits = 2) %>%
     kable_styling()

```


**MODA:**

Moda é o valor que ocorre com mais frequência.

```{r, warning=F}
moda <- function(x, na.rm=T) {
modal <- unique(x, na.rm=T)
modal[which.max(tabulate(match(x, modal)))]
}
moda(final_fem_22$feminic_tx)
```
```{r, warning=F}

fun1 <- function(x, na.rm = TRUE) c(media=mean(x, na.rm = TRUE), mediana=median(x, na.rm = TRUE), moda=moda(x))

median_1 <- (sapply(final_fem_22[4:17], fun1))

t(median_1) %>% 
  kbl(digits = 2) %>%
     kable_styling()

```

#### Visualizando as medidas por categorias

**Gráfico de Pizza**
O gráfico de pizza indica as proporções de uma determinada variável de classe. aqui utilizamos a média do número de feminicídios absoluto por região.


```{r}
pie(mean_1$feminic_abs , labels = c("CO","N","NE","S","SD"), border="lightgray")
```


**Gráfico de Barra**

Em geral a utilização do gráfico de barras está relacionado ao entendimento da frequência de valores associados a uma determinada categoria. Por exemplo, imagine que temos um banco de dados com as pessoas classificadas como: i)Não trabalha; ii)Trabalha e iii)Desempregado. Teríamos três categorias e a frequência de pessoas em cada categoria. Poderíamos ainda dividir essa categoria entre homens e mulheres. Essa é a utilização mais padrão do gráfico de barras. Vejamos alguns gráficos: 
 


```{r}
final_fem_22<- final_fem_22[order(-final_fem_22$feminic_tx),]

barplot(final_fem_22$feminic_tx, main="Taxa de Feminicídio por Estado", 
        names.arg=final_fem_22$estados,
        col="salmon2",border="lightsalmon3",
        las = 2, 
        cex.names = 0.7,
        xlab="", ylab="Tx. por 100 mil")
```

```{r}
final_fem_22<- final_fem_22[order(-final_fem_22$part_feminic),]

barplot(final_fem_22$part_feminic, main="Participação da Taxa de Feminicídio no Total por Estado", 
        names.arg=final_fem_22$estados,
        col="darkblue",border="steelblue",
        las = 2, 
        cex.names = 0.7,
        xlab="", ylab="Tx. por 100 mil")
```

```{r}
g_b1<- mean_1[c(1,5,13)]
g_b1$tx_f <- "Feminicídio (tx)" 
g_b1$tx_t_f <- "Tentativa de Fem. (tx)"
g_b2<- g_b1[c(1,2,4)]
names(g_b2)<-c("regiao", "taxa", "tipo")
g_b3<- g_b1[c(1,3,5)]
names(g_b3)<-c("regiao", "taxa", "tipo")
g_barra1<-rbind(g_b2, g_b3)


barplot(taxa ~ tipo + regiao, data = g_barra1, 
        beside = T,
        #legend.text = TRUE,
        ylim = c(0,8),
        ylab = "Taxa (100 mil mulheres)",
        xlab = "Região",
        col = c("lightsalmon3", "lightskyblue3"))

# Adicionando a legenda
legend("topright", title = "", legend = c("Feminicídio ", "Tentativa Feminicídio"), pch = 15 , box.lwd = 0,box.col = "white",bg = "white", col = c("lightsalmon3", "lightskyblue3")
)

# Incluindo o eixo x
abline(h=0)
```

**Gráfico de Linha**

O gráfico de linha ou pontos é muito utilizado para visualização da evolução de séries. É um gráfico que nos permite ver a evolução dos salários entre homens e mulheres, evolução dos preços dos alimentos, evolução do número de casos de feminicídio, evolução dos processos em determinada Vara.

Nosso banco é uma fotografia e não uma evolução, o que torna esse tipo de visualização menos útil. Vejamos a participação de feminicídio por estado

```{r}
final_fem_22<- final_fem_22[order(-final_fem_22$total_abs),]

plot(x=final_fem_22$total_abs, y=final_fem_22$t_feminic_tx,
     type="b" , bty="l" , 
     ylim=c(0,12),
     col=rgb(0.2,0.4,0.1,0.7) , lwd=2 , pch=17,
     main="Tentativa eFeminídio Taxa", 
     xlab = "Total de Homicídios", ylab="Taxa / 100 mil "
      )
# Adicionando nova variável
lines(x=final_fem_22$total_abs, y=final_fem_22$feminic_tx, col=rgb(0.8,0.4,0.1,0.7) , lwd=2 , pch=19 , type="b" )

# Inserindo a Legenda

legend("topright", 
  legend = c("Tentativa", "Feminicídio"), 
  col = c(rgb(0.2,0.4,0.1,0.7), 
  rgb(0.8,0.4,0.1,0.7)), 
  pch = c(17,19), 
  bty = "n", 
  pt.cex = 1, 
  cex = 0.8, 
  text.col = "black", 
  horiz = F , 
  inset = c(0.1, 0.1))

```




**PERCENTIL:**

O p-esimo percentil é um valor tal que ao menos p por cento das observações são menores ou iguais à ele e pelo menos (100-p) por cento das observações são maiores ou iguais a esse valor.

*Etapas para calcular o p-ésimo percentil*

**Etapa 1**: Organize os dados em ordem crescente. 

**Etapa 2**: Calcule um indice, $i$ tal que $$i = \frac{p}{100} \times n$$ onde $p$ é o percentil procurado

**Etapa 3**: 

  a) Se $i$ não for um número inteiro, arredondeo-o para cima. O próximo número inteiro maior que $i$ denota a posição do p-esimo percentil. 
  b) Se $i$ for um número inteiro o p-esimo percentil será a média dos valores que o ocupam as posições $i$ e $i + 1$.



```{r, warning=F}

quantile(final_fem_22$feminic_tx, probs = c(0.10,0.30,0.60,0.85), na.rm=T)

```

**QUARTIS:**

Os quartis são medidas estatísticas que dividem um conjunto de dados ordenados em quatro partes iguais.

O três quartis são:

**Primeiro Quartil (Q1)**: Representa o valor abaixo do qual está situada a primeira quarta parte (ou 25% inferiores) dos dados quando eles estão ordenados em ordem crescente. O primeiro quartil é o valor que divide os dados em 25% (ou 0.25) abaixo e 75% (ou 0.75) acima desse ponto.

**Segundo Quartil (Q2)**: Corresponde à mediana dos dados, dividindo o conjunto em duas metades iguais. É o valor que separa os 50% inferiores dos 50% superiores dos dados. 

**Terceiro Quartil (Q3)**: Indica o valor acima do qual está situada a terceira quarta parte (ou 25% superiores) dos dados quando eles estão ordenados. Assim como o primeiro quartil, o terceiro quartil divide os dados em 75% (ou 0.75) abaixo e 25% (ou 0.25) acima desse ponto

```{r, warning=F}

quantile(final_fem_22$feminic_tx, na.rm=T)

```
**AMPLITUDE:**

Amplitude é a diferença entre o valor mínimo e máximo de uma série de dados. 

$$\text{Amplitude} = \text{Maior Valor} - \text{Menor Valor}$$

```{r}
min_max<-range(final_fem_22$feminic_tx)
amp<-min_max[2]-min_max[1]
amp
```

**AMPLITUDE INTERQUANTIL:**

A amplitude interquartil é dada pela diferenca entre o terceiro ($Q_3$) e o primeiro quartil ($Q_1$).

$$IQR = Q_3 - Q_1$$

```{r}
qs<-quantile(final_fem_22$feminic_tx, na.rm=T)
iq<-qs[4]-qs[2]
IQR(final_fem_22$feminic_tx)
iq
```


#### Visualizando a Distribuição dos Dados

**Boxplot** 

O boxplot é um gráfico que traz muitas informações e pode ser visto como a distribuição de probabilidade dos dados. O box contém 50\% dos dados. O limite superior indica o percentil de 75\% (*Q*3) e o limite inferior indica o percentil de 25\% (*Q1*). A linha que corta o box indica a mediana, ou seja, *Q2*. Os bigodes são calculados com base na distância interquantílica, ou seja,

*Limite inferior: Q1-1,5(Q3-Q1)*

*Limite superior:Q3+1,5(Q3-Q1)* 

Dados fora desses limites são classificados como suspeitos de serem outlier. Podemos observar a assimetria dos dados quando a mediana não está no meio da caixa, indicando maior densidade na menor distância entre os quartis Q1 ou Q3 e a mediana Q2. Vejamos agora o boxplot da taxa de feminicídio e da taxa de feminicídio por região.


```{r}
boxplot(final_fem_22$feminic_tx,data=final_fem_22, main="Boxplot da taxa de feminicídio no Brasil, 2022", horizontal=TRUE,
  xlab="", ylab="Tx de Feminicídio/100mil", col="steelblue")
```
```{r}
boxplot(final_fem_22$feminic_tx~final_fem_22$regiao,data=final_fem_22, main="Boxplot da taxa de feminicídio no Brasil, 2022", horizontal=TRUE,
  xlab="", ylab="Tx de Feminicídio/100mil", col="steelblue")

```


O Violin Plot é muito parecido com o BoxPlot mas com a densidade de kernel rotacionada em cada um dos lados. Assim, indica a distribuição dos dados em cada ponto e vem anotado a mediana na forma de um ponto ou marca e um pequeno boxplot no centro do violin plot.



```{r}
#Binária para nordeste e centro oeste 1 e demais regiões 0
final_fem_22$N_NE_CO<-0
final_fem_22$N_NE_CO[final_fem_22$regiao == "N" | final_fem_22$regiao == "NE" | final_fem_22$regiao == "CO"] <- 1

table(final_fem_22$N_NE_CO, final_fem_22$regiao)
```

```{r, warning=FALSE, message=FALSE}
library(vioplot) 
x1 <- final_fem_22$feminic_tx[final_fem_22$N_NE_CO==1]
x2 <- final_fem_22$feminic_tx[final_fem_22$N_NE_CO==0]
vioplot(x1, x2, names=c("Norte, Nord. e C.Oeste", "Sul e Sudeste"), col=c("steelblue", "lightblue"), border="white" )
title("Violin Plots da taxa de feminicídio por região do Brasil")
```


Aqui segue uma sugestão de plotar o histograma juntamente com o boxplot, possibilitando em um mesmo gráfico uma maior quantidade de observação. Veja abaixo:
  
  
```{r, warning=FALSE}
par(fig=c(0,0.6,0,0.6), new=TRUE)
hist(final_fem_22$feminic_tx, main="", xlab="Taxa Feminicídio", ylab="Frequência", col="lightblue2")
par(fig=c(0,0.6,0.15,0.9), new=TRUE)
boxplot(final_fem_22$feminic_tx, horizontal=TRUE, axes=FALSE, col="navajowhite2")

```

 
**Gráfico de Densidade**

Visualizar a distribuição empírica dos dados fornece uma grande quantidade de informação. Um gráfico básico em análise descritiva é o histograma, o qual fornece a distribuição de probabilidade empírica dos dados em um formato de barras. A área do histograma é igual a 1 e altura da sua barra da a densidade de observações em cada classe. 


```{r,warnings=FALSE}
  hist(final_fem_22$feminic_tx, 
       breaks=8,  # número de barras do histograma
       col="steelblue",  #cor do preenchimento
       xlab="Taxa de Feminicídio",  # Títulos de eixos e gráfico
       ylab="Frequência", 
       main="Histograma da Taxa de Feminicídio")
```


Podemos plotar o histograma conjuntamente com um modelo de distribuição de probabilidade. Utilizaremos a distribuição normal com mesma esperança e desvio padrão. 


```{r,warnings=FALSE}
x <- final_fem_22$feminic_tx 
h<-hist(x, breaks=8, col="steelblue",xlab="Taxa de Feminicídio", ylab="Frequência",
        main="Histograma da taxa de feminicídio e a aproximação pela normal") 

xfit<-seq(0,max(x),length=40) 
yfit<-dnorm(xfit,mean=mean(x),sd=sd(x)) 
yfit <- yfit*diff(h$mids[1:2])*length(x) 
lines(xfit, yfit, col="lightsalmon", lwd=2)
```


Uma outra maneira de visualizar os dados é utilizando uma distribuição continua e não mais a discreta. Para isso, utiliza-se a densidade de Kernel para visualização da distribuição de probabilidade da taxa de feminicídio. Vejamos



```{r}
  k <- density(final_fem_22$feminic_tx)
  plot(k, xlab="Taxa de Feminicídio",main="Densidade de Kernel para a taxa de feminicídio")
  polygon(k, col="burlywood3", border="burlywood4")
```


Outra forma útil de visualizar os dados a é distribuição por classe, por exemplo distribuição de salários entre homens e mulheres, tempo do processo por vara, distribuição da taxa de feminicídio por regiaão. Vamos utilizar a densidade de Kernel para analisar a distribuição dos valores da taxa de feminicídio por região. Para isso precisa instalar o pacote `sm`.



```{r,message=F}
#install.packages("sm")
library(sm)
sm.density.compare(final_fem_22$feminic_tx, final_fem_22$N_NE_CO, xlab="Taxa de Feminicídio", lwd=c(3, 3),col=c('darkgreen', 'darkblue'))
title(main="Comparação da taxa de feminicídio entre regiôes")

legend("topright", c("S SD", "N NE CO"), xpd = TRUE, horiz = FALSE , bty = "n",  col=c('darkgreen', 'darkblue'), lwd=c(4, 4), cex = 0.6)
```


### Medidas de Variabilidade

A variância amostral é uma medida estatística que indica o quão dispersos estão os dados em relação à média amostral. Em outras palavras, ela quantifica a extensão das diferenças individuais entre os valores observados e a média da amostra.

A variância populacional é semelhante à variância amostral, mas é calculada utilizando todos os dados de uma população em vez de uma amostra. Ela descreve a dispersão dos dados em relação à média populacional.



**VARIÂNCIA E DESVIO PADRÃO AMOSTRAL**:

Definimos a vriância amostral como: 

$$s^2 = \frac{\sum_{i=1}^{n} (x_i - \bar{x})^2}{n-1}$$ onde $\bar{x}$ é a média amostral.

Vejamos a variância da taxa de feminicídio e do femnicídio absoluto:

```{r}
var(final_fem_22$feminic_tx, na.rm=T)

var(final_fem_22$feminic_abs, na.rm=T)

```


O **Desvio padrão amostral** é derivado da variância. Podemos qualcular essa estatistica da seguinte maneira:


$$s = \sqrt{s^2} = \sqrt{\frac{\sum_{i=1}^{n} (x_i - \bar{x})^2}{n-1}}$$

Para os nossos dados anteriores: 

```{r}
###Calculo do Desvio padrão

#DP taxa de feminicidio
sd(final_fem_22$feminic_tx, na.rm=T)

#DP  Feminicidio absoluto
sd(final_fem_22$feminic_abs, na.rm=T)


```

Vamos consolidar agora nossas estatísticas descritivas

```{r, warning=F}

fun1 <- function(x, na.rm = TRUE) c(media=mean(x, na.rm = TRUE), med=median(x, na.rm = TRUE), var=var(x, na.rm = TRUE), dp=sd(x, na.rm = TRUE))

est_descrit <- (sapply(final_fem_22[4:17], fun1))

t(est_descrit) %>% 
  kbl(digits = 2) %>%
     kable_styling()

```

**COEFICIENTE DE VARIAÇÃO**:

O coeficiente de variação (CV) é uma medida de dispersão relativa que expressa a variabilidade dos dados como uma porcentagem da média.

$$\text{CV} = \left( \frac{\text{Desvio padrão}}{\text{Média}} \right) \times 100\%$$


```{r}

# Vamos calcular o coeficiente de variacao

# O R nao tem nehuma funçao para isso, mas podemos fazer isso rapidamente

# Acessando os dados da variável
feminic_abs <- final_fem_22$feminic_abs

# Calcular a média da variável
media_variavel <- mean(feminic_abs, na.rm = TRUE)

# Calcular o desvio padrão da variável
desvio_padrao_variavel <- sd(feminic_abs, na.rm = TRUE)

# Calcular o coeficiente de variação
coeficiente_variacao <- (desvio_padrao_variavel / media_variavel) * 100

# Exibindo o coeficiente de variação
print(coeficiente_variacao)
```

### Medidas de Associação

**COVARIÂNCIA AMOSTRAL**

Covariância entre duas variáveis: A covariância entre duas variáveis X e Y é uma medida estatística que descreve como essas variáveis variam juntas. Em outras palavras, a covariância indica a tendência de X e Y de se moverem na mesma direção (covariância positiva) ou em direções opostas (covariância negativa).

$$\text{Cov}(X, Y) = \frac{1}{n-1} \sum_{i=1}^{n} (X_i - \bar{X})(Y_i - \bar{Y})$$


```{r}
 cov(final_fem_22$feminic_tx, final_fem_22$homic_tx)
```


**CORRELAÇÃO**

O coeficiente de correlação entre duas variáveis X e Y é uma medida estatística que descreve a força e a direção da relação linear entre essas variáveis. O coeficiente de correlação é frequentemente representado pelo coeficiente de correlação de Pearson, $r_{XY}$.

$$r_{XY} = \frac{\text{Cov}(X, Y)}{s_X s_Y}$$ O coeficiente de correlação de Pearson é uma medida amplamente utilizada para avaliar a relação linear entre variáveis, pois fornece uma interpretação padronizada da força e direção da relação, independentemente das unidades das variáveis.

```{r}
 cor(final_fem_22$feminic_tx, final_fem_22$homic_tx)

```



**Scatter plot**

O Scatter plot é conhecido como o gráfico de dispersão. Ele relaciona duas ou três variáveis, ou seja, plota $X$ contra $Y$. Muito utilizado para ver o comportamento conjunto de duas séries. Observe que renda e a taxa de feminicídio não mostram um comportamento conjunto, estão dispersas. 

```{r}

##Dispersão entre renda per capita e a taxa de feminicidio
plot(final_fem_22$rendapc, final_fem_22$feminic_tx,
     main = "Taxa de Feminicídio vs. Renda Per Capita",
     xlab = "Renda Per Capita",
     ylab = "Taxa de Feminicídio",
     col = "steelblue",          # Cor dos pontos
     pch = 16,              # Forma dos pontos (círculos sólidos)
     cex = 1.5              # Tamanho dos pontos
)
abline(lm(final_fem_22$feminic_tx~final_fem_22$rendapc), col="lightblue4", lwd=2)

```

Ao observar a taxa de homicídio e a taxa de feminicídio, estados com maior taxa de homicídio tendem a ter maior taxa de feminicídio. 

```{r}

##Dispersão entre renda per capita e a taxa de feminicidio
plot(final_fem_22$homic_tx, final_fem_22$feminic_tx,
     main = "Taxa de Feminicídio vs. Taxa de Homicidios",
     xlab = "Taxa de Homicidio",
     ylab = "Taxa de Feminicídio",
     col = "lightgoldenrod3",          # Cor dos pontos
     pch = 16,              # Forma dos pontos (círculos sólidos)
     cex = 1.5              # Tamanho dos pontos
)
abline(lm(final_fem_22$feminic_tx~final_fem_22$homic_tx), col="lightblue4", lwd=2)
```



```{r,message=F, warning=F}
library(corrgram)
correl<- final_fem_22[c(5,7,8,9,13,15,16)]
corrgram(correl, order=TRUE, lower.panel=panel.shade, upper.panel=panel.cor,  main="Correlação entre as diversas variáveis") 


```


### Teste de Hipótese

Vamos testar a hipótese de que as taxas de feminicídio são iguais entre as regiões norte, nordeste e centro oeste e as regiões sul e sudeste. Vamos permitir que as variâncias sejam diferentes entre as duas regiões

$$H_0: \mu_{N-NE-CO} = \mu_{S-SD}$$
$$H_1: \mu_{N-NE-CO} \neq \mu_{S-SD}$$
```{r}
t.test(feminic_tx~N_NE_CO, data=final_fem_22) 
```
O teste mostra que não rejeitamos a hipótese nula de que as duas regiões possuem a mesma média de taxa de feminicídio. 

Vejamos agora a renda per capita: 
```{r}
t.test(rendapc~N_NE_CO, data=final_fem_22) 
```

Observa-se que rejeita-se a hipótese nula, e há evidências de que a média da renda per capita entre as duas regiões são diferentes. 




**GRÁFICOS COM GGPLOT2**

  O pacote ggplot2 vem se consolidando como um dos pacotes mais usados para geração de gráficos. Ele tem algumas vantagens como:
  
  - Bastante flexível
  - Poderoso
  - Muito personalizável
  - Bonito!

Mas algumas coisas não deveriam ser feitas com ggplot, pois existem pacotes mais especializados:
  
  - Gráficos 3D (pacote rgl)
  - Grafos (pacote igraph)
  - Gráficos interativos (pacote ggvis)


**A gramática dos gráficos**
  
  Para criarmos gráficos com ggplot,  utilizamos __blocos__ de sintaxe que vão sendo empilhados para criar o gráfico pretendido

  Os blocos com os quais podemos trabalhar são:
  
  - Dados
  - Mapeamento estético
  - Objetos geométricos 
  - Transformações estatíticas
  - Escalas
  - Sistema de coordenadas
  - Ajustes de posição
  


## Histograma

```{r, fig.width=6, fig.align='center',fig.height=3.5}
library(ggplot2)

p<-  ggplot(data=final_fem_22, aes(x = feminic_tx, y = after_stat(density))) + 
  geom_histogram(bins=10, col="darkblue",fill=I("steelblue"))+
  geom_vline(aes(xintercept = mean(feminic_tx)),  color = "lightsalmon3", linewidth = 1) +
  geom_density(color = "darkgoldenrod", linewidth = 2)

p + labs(title="Distrição da taxa de Feminicídio nos Estados", x="Taxa de Feminicídio", y="Densidade")
```




