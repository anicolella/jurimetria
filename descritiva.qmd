---
title: "Análise Descritiva"
subtitle: "Tirando Informação dos Dados"
author:
- Alexandre Nicolella
date: "2024"
format: html
---


## Estatisticas Descritivas: Medidas Numéricas a partir da amostra

Existem outros métodos númericos que se constituem como alternativas adcionais para sintetizar os dados. Podemos dividir as medidas numericas em duas, temos as medidas de posíção e as de variabilidade.

**MEDIDAS DE POSIÇÃO:**

-   Média,
-   Mediana,
-   Moda,
-   Percentis,
-   Quartis.

**MEDIDAS DE VARIABILIDADE:**

-   Amplitude,
-   Amplitude interquartil,
-   Variância,
-   Desvio Padrão e
-   Coeficiente de Variação.

**MEDIDAS DE ASSOCIAÇÃO:**

-   Covariancia e
-   Coeficiente de Correlção.

Vamos apresentar as fórmulas de algumas dessas principais medidas.

```{r}
final_fem_22 <- read.csv("C:/Users/Alexandre_Nicolella/Aulas/FEA-RP/Jurimetria/jurimetria/final_fem_22.csv", head=T ,sep=";")

```




### Medidas de Posição:

**MÉDIA AMOSTRAL:**

$$\bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i$$

```{r, warning=F}
mean(final_fem_22$feminic_tx)
```

```{r, warning=F}
library(kableExtra)

mean_1<- aggregate(final_fem_22[4:17], list(final_fem_22$regiao), mean,  na.rm=T)

t(mean_1) %>% 
  kbl(digits = 2) %>%
     kable_styling()
```



**MEDIANA:**

Organize os dados em ordem crescente.

a)  Para um numero impar de observações a mediana é o valor que ocupa a posição central.

b)  para um número par de observações, a mediana é a média dos dois valores centrais.


```{r, warning=F}
median(final_fem_22$feminic_tx)
```
```{r, warning=F}

fun1 <- function(x, na.rm = TRUE) c(media=mean(x, na.rm = TRUE), mediana=median(x, na.rm = TRUE))

median_1 <- (sapply(final_fem_22[4:17], fun1))

t(median_1) %>% 
  kbl(digits = 2) %>%
     kable_styling()

```


**MODA:**

Moda é o valor que ocorre com mais frequência.

```{r, warning=F}
moda <- function(x, na.rm=T) {
modal <- unique(x, na.rm=T)
modal[which.max(tabulate(match(x, modal)))]
}
moda(final_fem_22$feminic_tx)
```
```{r, warning=F}

fun1 <- function(x, na.rm = TRUE) c(media=mean(x, na.rm = TRUE), mediana=median(x, na.rm = TRUE), moda=moda(x))

median_1 <- (sapply(final_fem_22[4:17], fun1))

t(median_1) %>% 
  kbl(digits = 2) %>%
     kable_styling()

```

#### Visualizando as medidas por categorias

**Gráfico de Pizza**

O gráfico de pizza indica as proporções de uma determinada variável de classe. Aqui utilizamos a média do número de feminicídios absoluto por região.


```{r}
pie(mean_1$feminic_abs , main = "Média Feminicídio por Região", 
    labels = c("CO","N","NE","S","SD"), border="lightgray")
```


**Gráfico de Barra**

Em geral a utilização do gráfico de barras está relacionado ao entendimento da frequência de valores associados a uma determinada categoria. Por exemplo, imagine que temos um banco de dados com as pessoas classificadas como: i)Não trabalha; ii)Trabalha e iii)Desempregado. Teríamos três categorias e a frequência de pessoas em cada categoria. Poderíamos ainda dividir essa categoria entre homens e mulheres. Essa é a utilização mais padrão do gráfico de barras. Vejamos alguns gráficos: 
 


```{r}
final_fem_22<- final_fem_22[order(-final_fem_22$feminic_tx),]

barplot(final_fem_22$feminic_tx, main="Taxa de Feminicídio por Estado", 
        names.arg=final_fem_22$estados,
        col="salmon2",border="lightsalmon3",
        las = 2, 
        cex.names = 0.7,
        xlab="", ylab="Tx. por 100 mil")
```

```{r}
final_fem_22<- final_fem_22[order(-final_fem_22$part_feminic),]

barplot(final_fem_22$part_feminic, main="Participação da Taxa de Feminicídio no Total por Estado", 
        names.arg=final_fem_22$estados,
        col="darkblue",border="steelblue",
        las = 2, 
        cex.names = 0.7,
        xlab="", ylab="Tx. por 100 mil")
```

```{r}
g_b1<- mean_1[c(1,5,13)]
g_b1$tx_f <- "Feminicídio (tx)" 
g_b1$tx_t_f <- "Tentativa de Fem. (tx)"
g_b2<- g_b1[c(1,2,4)]
names(g_b2)<-c("regiao", "taxa", "tipo")
g_b3<- g_b1[c(1,3,5)]
names(g_b3)<-c("regiao", "taxa", "tipo")
g_barra1<-rbind(g_b2, g_b3)


barplot(taxa ~ tipo + regiao, data = g_barra1, 
        beside = T,
        #legend.text = TRUE,
        ylim = c(0,8),
        ylab = "Taxa (100 mil mulheres)",
        xlab = "Região",
        col = c("lightsalmon3", "lightskyblue3"))

# Adicionando a legenda
legend("topright", title = "", legend = c("Feminicídio ", "Tentativa Feminicídio"), pch = 15 , box.lwd = 0,box.col = "white",bg = "white", col = c("lightsalmon3", "lightskyblue3")
)

# Incluindo o eixo x
abline(h=0)
```

**Gráfico de Linha**

O gráfico de linha ou pontos é muito utilizado para visualização da evolução de séries. É um gráfico que nos permite ver a evolução dos salários entre homens e mulheres, evolução dos preços dos alimentos, evolução do número de casos de feminicídio, evolução dos processos em determinada Vara.

Nosso banco é uma fotografia e não uma evolução, o que torna esse tipo de visualização menos útil. Vejamos a participação de feminicídio por estado

```{r}
final_fem_22<- final_fem_22[order(-final_fem_22$total_abs),]

plot(x=final_fem_22$total_abs, y=final_fem_22$t_feminic_tx,
     type="b" , bty="l" , 
     ylim=c(0,12),
     col=rgb(0.2,0.4,0.1,0.7) , lwd=2 , pch=17,
     main="Tentativa eFeminídio Taxa", 
     xlab = "Total de Homicídios", ylab="Taxa / 100 mil "
      )
# Adicionando nova variável
lines(x=final_fem_22$total_abs, y=final_fem_22$feminic_tx, col=rgb(0.8,0.4,0.1,0.7) , lwd=2 , pch=19 , type="b" )

# Inserindo a Legenda

legend("topright", 
  legend = c("Tentativa", "Feminicídio"), 
  col = c(rgb(0.2,0.4,0.1,0.7), 
  rgb(0.8,0.4,0.1,0.7)), 
  pch = c(17,19), 
  bty = "n", 
  pt.cex = 1, 
  cex = 0.8, 
  text.col = "black", 
  horiz = F , 
  inset = c(0.1, 0.1))

```




**PERCENTIL:**

O p-esimo percentil é um valor tal que ao menos p por cento das observações são menores ou iguais à ele e pelo menos (100-p) por cento das observações são maiores ou iguais a esse valor.

*Etapas para calcular o p-ésimo percentil*

**Etapa 1**: Organize os dados em ordem crescente. 

**Etapa 2**: Calcule um indice, $i$ tal que $$i = \frac{p}{100} \times n$$ onde $p$ é o percentil procurado

**Etapa 3**: 

  a) Se $i$ não for um número inteiro, arredondeo-o para cima. O próximo número inteiro maior que $i$ denota a posição do p-esimo percentil. 
  b) Se $i$ for um número inteiro o p-esimo percentil será a média dos valores que o ocupam as posições $i$ e $i + 1$.



```{r, warning=F}

quantile(final_fem_22$feminic_tx, probs = c(0.10,0.30,0.60,0.85), na.rm=T)

```

**QUARTIS:**

Os quartis são medidas estatísticas que dividem um conjunto de dados ordenados em quatro partes iguais.

O três quartis são:

**Primeiro Quartil (Q1)**: Representa o valor abaixo do qual está situada a primeira quarta parte (ou 25% inferiores) dos dados quando eles estão ordenados em ordem crescente. O primeiro quartil é o valor que divide os dados em 25% (ou 0.25) abaixo e 75% (ou 0.75) acima desse ponto.

**Segundo Quartil (Q2)**: Corresponde à mediana dos dados, dividindo o conjunto em duas metades iguais. É o valor que separa os 50% inferiores dos 50% superiores dos dados. 

**Terceiro Quartil (Q3)**: Indica o valor acima do qual está situada a terceira quarta parte (ou 25% superiores) dos dados quando eles estão ordenados. Assim como o primeiro quartil, o terceiro quartil divide os dados em 75% (ou 0.75) abaixo e 25% (ou 0.25) acima desse ponto

```{r, warning=F}

quantile(final_fem_22$feminic_tx, na.rm=T)

```
**AMPLITUDE:**

Amplitude é a diferença entre o valor mínimo e máximo de uma série de dados. 

$$\text{Amplitude} = \text{Maior Valor} - \text{Menor Valor}$$

```{r}
min_max<-range(final_fem_22$feminic_tx)
amp<-min_max[2]-min_max[1]
amp
```

**AMPLITUDE INTERQUANTIL:**

A amplitude interquartil é dada pela diferenca entre o terceiro ($Q_3$) e o primeiro quartil ($Q_1$).

$$IQR = Q_3 - Q_1$$

```{r}
qs<-quantile(final_fem_22$feminic_tx, na.rm=T)
iq<-qs[4]-qs[2]
IQR(final_fem_22$feminic_tx)
iq
```


#### Visualizando a Distribuição dos Dados

**Boxplot** 

O boxplot é um gráfico que traz muitas informações e pode ser visto como a distribuição de probabilidade dos dados. O box contém 50\% dos dados. O limite superior indica o percentil de 75\% (*Q*3) e o limite inferior indica o percentil de 25\% (*Q1*). A linha que corta o box indica a mediana, ou seja, *Q2*. Os bigodes são calculados com base na distância interquantílica, ou seja,

*Limite inferior: Q1-1,5(Q3-Q1)*

*Limite superior:Q3+1,5(Q3-Q1)* 

Dados fora desses limites são classificados como suspeitos de serem outlier. Podemos observar a assimetria dos dados quando a mediana não está no meio da caixa, indicando maior densidade na menor distância entre os quartis Q1 ou Q3 e a mediana Q2. Vejamos agora o boxplot da taxa de feminicídio e da taxa de feminicídio por região.


```{r}
boxplot(final_fem_22$feminic_tx,data=final_fem_22, main="Boxplot da taxa de feminicídio no Brasil, 2022", horizontal=TRUE,
  xlab="", ylab="Tx de Feminicídio/100mil", col="steelblue")
```
```{r}
boxplot(final_fem_22$feminic_tx~final_fem_22$regiao,data=final_fem_22, main="Boxplot da taxa de feminicídio no Brasil, 2022", horizontal=TRUE,
  xlab="", ylab="Tx de Feminicídio/100mil", col="steelblue")

```


O Violin Plot é muito parecido com o BoxPlot mas com a densidade de kernel rotacionada em cada um dos lados. Assim, indica a distribuição dos dados em cada ponto e vem anotado a mediana na forma de um ponto ou marca e um pequeno boxplot no centro do violin plot.



```{r}
#Binária para nordeste e centro oeste 1 e demais regiões 0
final_fem_22$N_NE_CO<-0
final_fem_22$N_NE_CO[final_fem_22$regiao == "N" | final_fem_22$regiao == "NE" | final_fem_22$regiao == "CO"] <- 1

table(final_fem_22$N_NE_CO, final_fem_22$regiao)
```

```{r, warning=FALSE, message=FALSE}
library(vioplot) 
x1 <- final_fem_22$feminic_tx[final_fem_22$N_NE_CO==1]
x2 <- final_fem_22$feminic_tx[final_fem_22$N_NE_CO==0]
vioplot(x1, x2, names=c("Norte, Nord. e C.Oeste", "Sul e Sudeste"), col=c("steelblue", "lightblue"), border="white" )
title("Violin Plots da taxa de feminicídio por região do Brasil")
```


Aqui segue uma sugestão de plotar o histograma juntamente com o boxplot, possibilitando em um mesmo gráfico uma maior quantidade de observação. Veja abaixo:
  
  
```{r, warning=FALSE}
par(fig=c(0,0.6,0,0.6), new=TRUE)
hist(final_fem_22$feminic_tx, main="", xlab="Taxa Feminicídio", ylab="Frequência", col="lightblue2")
par(fig=c(0,0.6,0.15,0.9), new=TRUE)
boxplot(final_fem_22$feminic_tx, main="Taxa de Feminicídio", horizontal=TRUE, axes=FALSE, col="navajowhite2")

```

 
**Gráfico de Densidade**

Visualizar a distribuição empírica dos dados fornece uma grande quantidade de informação. Um gráfico básico em análise descritiva é o histograma, o qual fornece a distribuição de probabilidade empírica dos dados em um formato de barras. A área do histograma é igual a 1 e altura da sua barra da a densidade de observações em cada classe. 


```{r,warnings=FALSE}
  hist(final_fem_22$feminic_tx, 
       breaks=8,  # número de barras do histograma
       col="steelblue",  #cor do preenchimento
       xlab="Taxa de Feminicídio",  # Títulos de eixos e gráfico
       ylab="Frequência", 
       main="Histograma da Taxa de Feminicídio")
```


Podemos plotar o histograma conjuntamente com um modelo de distribuição de probabilidade. Utilizaremos a distribuição normal com mesma esperança e desvio padrão. 


```{r,warnings=FALSE}
x <- final_fem_22$feminic_tx 
h<-hist(x, breaks=8, col="steelblue",xlab="Taxa de Feminicídio", ylab="Frequência",
        main="Histograma da taxa de feminicídio e a aproximação pela normal") 

xfit<-seq(0,max(x),length=40) 
yfit<-dnorm(xfit,mean=mean(x),sd=sd(x)) 
yfit <- yfit*diff(h$mids[1:2])*length(x) 
lines(xfit, yfit, col="lightsalmon", lwd=2)
```


Uma outra maneira de visualizar os dados é utilizando uma distribuição continua e não mais a discreta. Para isso, utiliza-se a densidade de Kernel para visualização da distribuição de probabilidade da taxa de feminicídio. Vejamos



```{r}
  k <- density(final_fem_22$feminic_tx)
  plot(k, xlab="Taxa de Feminicídio",main="Densidade de Kernel para a taxa de feminicídio")
  polygon(k, col="burlywood3", border="burlywood4")
```


Outra forma útil de visualizar os dados a é distribuição por classe, por exemplo distribuição de salários entre homens e mulheres, tempo do processo por vara, distribuição da taxa de feminicídio por regiaão. Vamos utilizar a densidade de Kernel para analisar a distribuição dos valores da taxa de feminicídio por região. Para isso precisa instalar o pacote `sm`.



```{r,message=F}
#install.packages("sm")
library(sm)
sm.density.compare(final_fem_22$feminic_tx, final_fem_22$N_NE_CO, xlab="Taxa de Feminicídio", lwd=c(3, 3),col=c('darkgreen', 'darkblue'))
title(main="Comparação da taxa de feminicídio entre regiôes")

legend("topright", c("S SD", "N NE CO"), xpd = TRUE, horiz = FALSE , bty = "n",  col=c('darkgreen', 'darkblue'), lwd=c(4, 4), cex = 0.6)
```


### Medidas de Variabilidade

A variância amostral é uma medida estatística que indica o quão dispersos estão os dados em relação à média amostral. Em outras palavras, ela quantifica a extensão das diferenças individuais entre os valores observados e a média da amostra.

A variância populacional é semelhante à variância amostral, mas é calculada utilizando todos os dados de uma população em vez de uma amostra. Ela descreve a dispersão dos dados em relação à média populacional.



**VARIÂNCIA E DESVIO PADRÃO AMOSTRAL**:

Definimos a vriância amostral como: 

$$s^2 = \frac{\sum_{i=1}^{n} (x_i - \bar{x})^2}{n-1}$$ onde $\bar{x}$ é a média amostral.

Vejamos a variância da taxa de feminicídio e do femnicídio absoluto:

```{r}
var(final_fem_22$feminic_tx, na.rm=T)

var(final_fem_22$feminic_abs, na.rm=T)

```


O **Desvio padrão amostral** é derivado da variância. Podemos qualcular essa estatistica da seguinte maneira:


$$s = \sqrt{s^2} = \sqrt{\frac{\sum_{i=1}^{n} (x_i - \bar{x})^2}{n-1}}$$

Para os nossos dados anteriores: 

```{r}

# Tx Feminicídio
sd(final_fem_22$feminic_tx, na.rm=T)

#Feminicídio Absoluto
sd(final_fem_22$feminic_abs, na.rm=T)


```

Vamos consolidar agora nossas estatísticas descritivas

```{r, warning=F}

fun1 <- function(x, na.rm = TRUE) c(media=mean(x, na.rm = TRUE), med=median(x, na.rm = TRUE), var=var(x, na.rm = TRUE), dp=sd(x, na.rm = TRUE))

est_descrit <- (sapply(final_fem_22[4:17], fun1))

t(est_descrit) %>% 
  kbl(digits = 2) %>%
     kable_styling()

```

**COEFICIENTE DE VARIAÇÃO**:

O coeficiente de variação (CV) é uma medida de dispersão relativa que expressa a variabilidade dos dados como uma porcentagem da média.

$$\text{CV} = \left( \frac{\text{Desvio padrão}}{\text{Média}} \right) \times 100\%$$


```{r}

# Vamos calcular o coeficiente de variacao

# O R nao tem nehuma funçao para isso, mas podemos fazer isso rapidamente

# Acessando os dados da variável
feminic_abs <- final_fem_22$feminic_abs

# Calcular a média da variável
media_variavel <- mean(feminic_abs, na.rm = TRUE)

# Calcular o desvio padrão da variável
desvio_padrao_variavel <- sd(feminic_abs, na.rm = TRUE)

# Calcular o coeficiente de variação
coeficiente_variacao <- (desvio_padrao_variavel / media_variavel) * 100

# Exibindo o coeficiente de variação
print(coeficiente_variacao)
print((sd(final_fem_22$t_feminic_abs, na.rm = TRUE)/ mean(final_fem_22$t_feminic_abs, na.rm = TRUE)) * 100)
```

Para entendermos vamos supor que existam duas variáveis com mesmo desvio padrão, igual a 10. A primeira terá média de 10 e a segunda de 20, vejamos a diferença no coeficiente de variação. 

$\text{CV}_{X_1}=\frac{10}{10}.100=100\%$ e $\text{CV}_{X_2}=\frac{10}{20}.100=50\%$

A variabilidade relativa é menor para a segunda variável. No exemplo acima a taxa de feminicídio tem uma variabilidade relativa maior (91\%) do que a tentativa de feminicídio (74\%) entre os Estados Brasileiros. 


### Medidas de Associação

**COVARIÂNCIA AMOSTRAL**

Covariância entre duas variáveis: A covariância entre duas variáveis X e Y é uma medida estatística que descreve como essas variáveis variam juntas. Em outras palavras, a covariância indica a tendência de X e Y de se moverem na mesma direção (covariância positiva) ou em direções opostas (covariância negativa).

$$\text{Cov}(X, Y) = \frac{1}{n-1} \sum_{i=1}^{n} (X_i - \bar{X})(Y_i - \bar{Y})$$


```{r}
 cov(final_fem_22$feminic_tx, final_fem_22$homic_tx)
```


**CORRELAÇÃO**

O coeficiente de correlação entre duas variáveis X e Y é uma medida estatística que descreve a força e a direção da relação linear entre essas variáveis. O coeficiente de correlação é frequentemente representado pelo coeficiente de correlação de Pearson, $r_{XY}$.

$$r_{XY} = \frac{\text{Cov}(X, Y)}{s_X s_Y}$$ O coeficiente de correlação de Pearson é uma medida amplamente utilizada para avaliar a relação linear entre variáveis, pois fornece uma interpretação padronizada da força e direção da relação, independentemente das unidades das variáveis.

```{r}
 cor(final_fem_22$feminic_tx, final_fem_22$homic_tx)

```



**Scatter plot**

O Scatter plot é conhecido como o gráfico de dispersão. Ele relaciona duas ou três variáveis, ou seja, plota $X$ contra $Y$. Muito utilizado para ver o comportamento conjunto de duas séries. Observe que renda e a taxa de feminicídio não mostram um comportamento conjunto, estão dispersas. 

```{r}

##Dispersão entre renda per capita e a taxa de feminicidio
plot(final_fem_22$rendapc, final_fem_22$feminic_tx,
     main = "Taxa de Feminicídio vs. Renda Per Capita",
     xlab = "Renda Per Capita",
     ylab = "Taxa de Feminicídio",
     col = "steelblue",          # Cor dos pontos
     pch = 16,              # Forma dos pontos (círculos sólidos)
     cex = 1.5              # Tamanho dos pontos
)
abline(lm(final_fem_22$feminic_tx~final_fem_22$rendapc), col="lightblue4", lwd=2)

```

Ao observar a taxa de homicídio e a taxa de feminicídio, estados com maior taxa de homicídio tendem a ter maior taxa de feminicídio. 

```{r}

##Dispersão entre renda per capita e a taxa de feminicidio
plot(final_fem_22$homic_tx, final_fem_22$feminic_tx,
     main = "Taxa de Feminicídio vs. Taxa de Homicidios",
     xlab = "Taxa de Homicidio",
     ylab = "Taxa de Feminicídio",
     col = "lightgoldenrod3",          # Cor dos pontos
     pch = 16,              # Forma dos pontos (círculos sólidos)
     cex = 1.5              # Tamanho dos pontos
)
abline(lm(final_fem_22$feminic_tx~final_fem_22$homic_tx), col="lightblue4", lwd=2)
```



```{r,message=F, warning=F}
library(corrgram)
correl<- final_fem_22[c(5,7,8,9,13,15,16)]
corrgram(correl, order=TRUE, lower.panel=panel.shade, upper.panel=panel.cor,  main="Correlação entre as diversas variáveis") 


```


### Teste de Hipótese

Vamos testar a hipótese de que as taxas de feminicídio são iguais entre as regiões norte, nordeste e centro oeste e as regiões sul e sudeste. Vamos permitir que as variâncias sejam diferentes entre as duas regiões

$$H_0: \mu_{N-NE-CO} = \mu_{S-SD}$$
$$H_1: \mu_{N-NE-CO} \neq \mu_{S-SD}$$
```{r}
t.test(feminic_tx~N_NE_CO, data=final_fem_22) 
```
O teste mostra que não rejeitamos a hipótese nula de que as duas regiões possuem a mesma média de taxa de feminicídio. 

Vejamos agora a renda per capita: 
```{r}
t.test(rendapc~N_NE_CO, data=final_fem_22) 
```

Observa-se que rejeita-se a hipótese nula, e há evidências de que a média da renda per capita entre as duas regiões são diferentes. 




**GRÁFICOS COM GGPLOT2**

  O pacote ggplot2 vem se consolidando como um dos pacotes mais usados para geração de gráficos. Ele tem algumas vantagens como:
  
  - Bastante flexível
  - Poderoso
  - Muito personalizável
  - Bonito!

Mas algumas coisas não deveriam ser feitas com ggplot, pois existem pacotes mais especializados:
  
  - Gráficos 3D (pacote rgl)
  - Grafos (pacote igraph)
  - Gráficos interativos (pacote ggvis)


**A gramática dos gráficos**
  
  Para criarmos gráficos com ggplot,  utilizamos __blocos__ de sintaxe que vão sendo empilhados para criar o gráfico pretendido

  Os blocos com os quais podemos trabalhar são:
  
  - Dados
  - Mapeamento estético
  - Objetos geométricos 
  - Transformações estatíticas
  - Escalas
  - Sistema de coordenadas
  - Ajustes de posição
  


## Histograma

```{r, fig.width=6, fig.align='center',fig.height=3.5}
library(ggplot2)

p<-  ggplot(data=final_fem_22, aes(x = feminic_tx, y = after_stat(density))) + 
  geom_histogram(bins=10, col="darkblue",fill=I("steelblue"))+
  geom_vline(aes(xintercept = mean(feminic_tx)),  color = "lightsalmon3", linewidth = 1) +
  geom_density(color = "darkgoldenrod", linewidth = 2)

p + labs(title="Distribuição da taxa de Feminicídio nos Estados", x="Taxa de Feminicídio", y="Densidade")
```




