[
  {
    "objectID": "oficina.html",
    "href": "oficina.html",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "",
    "text": "18 Oficina em análise de sobrevivência",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#instalar-pacotes",
    "href": "oficina.html#instalar-pacotes",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.1 Instalar pacotes",
    "text": "18.1 Instalar pacotes\n\ninstall.packages(\"ggsurvfit\")\nremotes::install_github(\"courtsbr/JurisMiner\")",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#criar-um-projeto",
    "href": "oficina.html#criar-um-projeto",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.2 Criar um projeto",
    "text": "18.2 Criar um projeto\n\nusethis::create_project(\"nome_do_seu_projeto\")",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#criar-pastas-necessárias",
    "href": "oficina.html#criar-pastas-necessárias",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.3 Criar pastas necessárias",
    "text": "18.3 Criar pastas necessárias\n\ndir.create(\"data-raw\")\ndir.create(\"data\")\ndir.create(\"docs\")\ndir.create(\"R\")\ndir.create(\"data-raw/datajud\")",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#criar-primeiro-script",
    "href": "oficina.html#criar-primeiro-script",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.4 Criar primeiro script",
    "text": "18.4 Criar primeiro script\n\nfile.create(\"R/rotina_1_coleta.R\")",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#carregar-pacotes-necessários",
    "href": "oficina.html#carregar-pacotes-necessários",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.5 Carregar pacotes necessários",
    "text": "18.5 Carregar pacotes necessários\n\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(ggsurvfit)\nlibrary(datajud)\nlibrary(JurisMiner)",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#definir-os-parâmetros-para-coleta-dos-dados",
    "href": "oficina.html#definir-os-parâmetros-para-coleta-dos-dados",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.6 Definir os parâmetros para coleta dos dados",
    "text": "18.6 Definir os parâmetros para coleta dos dados\n\ntribunal &lt;- \"tjto\"\nclasse &lt;- \"282\" ## Dei exemplo do juri\ngrau &lt;- \"G1\"\nassunto &lt;- \"\"\ndistribuicao &lt;- \"26\"\njulgado &lt;- \"\"\ndata_inicial &lt;- \"2020-01-01\"\ndata_final &lt;- \"2025-11-25\"\n\ntamanho_pagina &lt;- 1000\ndiretorio &lt;- \"data-raw/datajud\"",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#baixar-os-dados-do-datajud",
    "href": "oficina.html#baixar-os-dados-do-datajud",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.7 Baixar os dados do datajud",
    "text": "18.7 Baixar os dados do datajud\n\nset_api_key(get_default_api_key())\n\nresults &lt;- search_processes_paginated(\n  tribunal = tribunal,\n  classe_codigo = classe,           \n  grau = grau,                      \n  dataAjuizamento_start = data_inicial,\n  dataAjuizamento_end = data_final,\n  page_size = tamanho_pagina,        \n  max_pages = NULL,                 # Buscar todas as páginas disponíveis\n  save_pages = TRUE,                # Salvar cada página\n  output_dir = diretorio\n)",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#ler-arquivos",
    "href": "oficina.html#ler-arquivos",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.8 Ler arquivos",
    "text": "18.8 Ler arquivos\n\narquivos &lt;- list.files(diretorio, full.names = TRUE)\n\njuri &lt;- map_dfr(arquivos, readRDS)",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#limpeza",
    "href": "oficina.html#limpeza",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.9 Limpeza",
    "text": "18.9 Limpeza\n\njuri &lt;- juri |&gt; \n   clean_names()\n\njuri &lt;- juri |&gt; \n   mutate(data_ajuizamento = str_sub(data_ajuizamento, 1,8) |&gt; ymd()) |&gt; \n   mutate(data_atualizacao = str_sub(data_hora_ultima_atualizacao, 1,10) |&gt;  ymd(), .after = tribunal)\n\njuri &lt;- juri |&gt; \n  slice_max(order_by = data_atualizacao,  by = c(numero_processo), n = 1)",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#classe",
    "href": "oficina.html#classe",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.10 Classe",
    "text": "18.10 Classe\n\nclasse &lt;- juri |&gt; \n     select(numero_processo, classe) |&gt; \n     unnest_longer(classe) |&gt; \n     mutate(classe = unlist(classe)) |&gt; \n     distinct() |&gt; \n     pivot_wider(names_from = \"classe_id\", values_from = \"classe\" )",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#órgão-julgador",
    "href": "oficina.html#órgão-julgador",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.11 Órgão julgador",
    "text": "18.11 Órgão julgador\n\norgao_julgador &lt;- juri |&gt; \n    select(numero_processo, orgao_julgador) |&gt; \n    unnest_longer(orgao_julgador) |&gt; \n    mutate(orgao_julgador = unlist(orgao_julgador)) |&gt; \n     distinct() |&gt; \n     pivot_wider(names_from = \"orgao_julgador_id\", values_from = \"orgao_julgador\" ) |&gt; \n     clean_names() |&gt; \n     unnest(cols = c(codigo_municipio_ibge, codigo, nome))\n\n\nentrancias &lt;- jsonlite::fromJSON(\"https://gist.githubusercontent.com/jjesusfilho/c150c20e5c1b45bf62d3057e78d86652/raw/99d21a002abb09d0f7b82f4241f9c25e8b0a29b9/entrancias_tjto.json\")\n\nentrancias &lt;- entrancias |&gt; \n     mutate(codigo = as.character(codigo)) |&gt; \n     select(codigo, entrancia)\n\norgao_julgador &lt;- orgao_julgador  |&gt; \n        left_join(entrancias, by = \"codigo\")",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#assuntos",
    "href": "oficina.html#assuntos",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.12 Assuntos",
    "text": "18.12 Assuntos\n\n  assuntos &lt;- juri |&gt; \n     select(numero_processo, assuntos) |&gt; \n     unnest_longer(assuntos) |&gt; \n     unnest_wider(assuntos, names_sep = \"_\") |&gt; \n     unnest_wider(assuntos_1)",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#movimentação",
    "href": "oficina.html#movimentação",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.13 Movimentação",
    "text": "18.13 Movimentação\n\n movimentacao &lt;- juri |&gt; \n      select(numero_processo, movimentos) |&gt; \n      unnest_longer(movimentos) |&gt; \n      unnest_wider(movimentos) |&gt; \n      clean_names() |&gt; \n      select(processo = numero_processo, codigo, nome, data_hora) |&gt; \n      mutate(data_hora = ymd_hms(data_hora, tz = \"America/Sao_Paulo\")) |&gt; \n      group_by(processo) |&gt; \n      arrange(desc(data_hora)) |&gt; \n      tempo_movimentacao(data_hora) |&gt; \n      rename(numero_processo  = processo)\n\n\n18.13.1 Seleção dos códigos de eventos de interesse\n\ncodigos_eventos &lt;- c(10953, 10961,11877) # pronúncia, impronúncia e absolvição sumária\ncodigos_impeditivos &lt;- c(1042,12769, 12735)  ## Morte, desclassificação, extinção da punibilidade\n\ncodigos_todos &lt;- c(codigos_eventos, codigos_impeditivos)\n\neventos &lt;- movimentacao |&gt; \n      filter(codigo %in% codigos_todos)\n\neventos &lt;- eventos |&gt; \n   mutate(evento = case_when(\n      codigo %in% codigos_eventos ~ \"decidido\",\n      TRUE ~ \"impedido\"\n  \n   ))\n\neventos &lt;- eventos |&gt; \n     select(numero_processo, tempo = decorrencia_acumulada, evento)\n\n\n\n18.13.2 Filtros dos casos censurados\n\nnao_eventos &lt;- movimentacao |&gt; \n          anti_join(eventos, by = \"numero_processo\")\n\n\nnao_eventos &lt;- nao_eventos |&gt; \n     group_by(numero_processo) |&gt; \n    filter(decorrencia_acumulada == max(decorrencia_acumulada))\n\nnao_eventos &lt;- nao_eventos |&gt; \n  mutate(evento = \"censurado\") |&gt; \n  select(numero_processo, tempo = decorrencia_acumulada, evento)\n\n\n\n18.13.3 Junção dos dois\n\neventos &lt;- eventos |&gt; \n     bind_rows(nao_eventos)\neventos &lt;- eventos |&gt; \n  distinct()\n\n\n\n18.13.4 Filtrar assuntos\n\ncodigos_assuntos &lt;- c(3372, 5555,3370, 12091, 11244) ## homicidio qualificado, simples, tentado e feminicidio.\n\nassuntos_selecionados &lt;- assuntos |&gt; \n  filter(assuntos_codigo %in% codigos_assuntos)\n\nassuntos_selecionados &lt;- assuntos_selecionados |&gt; \n     select(numero_processo, crime = assuntos_nome) |&gt; \n     mutate(crime = JurisMiner::snakecase(crime)) |&gt; \n     distinct(numero_processo, .keep_all = TRUE)",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#junta-as-duas-tabelas",
    "href": "oficina.html#junta-as-duas-tabelas",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.14 Junta as duas tabelas",
    "text": "18.14 Junta as duas tabelas\n\norgao_entrancia &lt;- orgao_julgador |&gt; \n  select(numero_processo,  entrancia) |&gt; \n  distinct()\n\nbase &lt;- eventos |&gt; \n    inner_join(assuntos_selecionados, by = \"numero_processo\") |&gt; \n    inner_join(orgao_entrancia)\n\n\n\nLoading required package: ggplot2\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ lubridate 1.9.4     ✔ tibble    3.3.0\n✔ purrr     1.2.0     ✔ tidyr     1.3.1\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  },
  {
    "objectID": "oficina.html#curva-de-kaplan-meier",
    "href": "oficina.html#curva-de-kaplan-meier",
    "title": "17  Oficina sobre análise de sobrevivência",
    "section": "18.15 Curva de Kaplan Meier",
    "text": "18.15 Curva de Kaplan Meier\n\nsurvfit(Surv(tempo) ~ entrancia , data = base) |&gt;\n  ggsurvfit(linewidth = 1) +\n  add_confidence_interval() +\n  add_risktable() +\n  add_quantile(y_value = 0.6, color = \"gray50\", linewidth = 0.75) +\n  scale_ggsurvfit()\n\n\n\n\n\n\n\n\n\n18.15.1 Função de incidência cumulativa\n\nbase &lt;- base |&gt; \n   mutate(evento = as.factor(evento))\n\n\nfit_cs1 &lt;- survfit(Surv(tempo, evento) ~ entrancia, data = base)\n\n\nggcuminc(fit_cs1,\noutcome = \"decidido\") +\n  add_confidence_interval() +\n  labs(title=\"Risco para decidido\")\n\n\n\n\n\n\n\n\n\nggcuminc(fit_cs1,\noutcome = \"impedido\") +\n  add_confidence_interval() +\n  labs(title=\"Risco para impedido\")",
    "crumbs": [
      "Home",
      "<span class='chapter-number'>17</span>  <span class='chapter-title'>Oficina sobre análise de sobrevivência</span>"
    ]
  }
]